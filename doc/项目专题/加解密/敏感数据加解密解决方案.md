                                  高频面试题：敏感数据加解密解决方案
一、业务背景
根据集团信息安全部门的要求，所有各个业务中心涉及敏感数据的表敏感字段及管理后台展示的敏感字段都要加密存储，防止信息外泄对公司不可估量的损失。

二、常见的敏感字段
手机号、地址、email、身份证号、银行卡号

三、目前的痛点及解决方案
目前的痛点：
新数据处理：
. 各个业务系统都是独立连接加密机，如果节点横向扩容，需求向安全组发邮件申请和审批，流程长，不能实时生效，在实时性要求很高的高并发场景非常危险。
. 各个业务接入安全组提供的client二方包，一旦安全组升级安全包，各业务都需要改造和测试，维护成本很高。
存量数据处理：
. 业务发展很多年，涉及的表很多，部分表数据量达到几亿，刷数是一项比较巨大的工程，那我们如何保证高效刷数不影响业务？

解决方案：
方案一： 提供统一的client sdk，由平台架构部门封装对接加密机相关的逻辑，对外屏蔽对接细节，各个业务引入sdk即可实现加解密功能。
   优点：本地直连的加密机，没网络io消耗，性能高。
   缺点：应用节点扩容还是需要申请和审批，实时性差。不过有个解决办法，云上的应用一般都会提前预分配一批可用IP列表方便随时扩容，
        这样的话，我们可以提前申请这批IP列表的白名单，只要不是大批量扩容需要另外的动态IP，基本也可以做到秒级扩秒级上效。
   适用场景：调用量非常大、性能要求很高、可用性和稳定性要求很强的金融属性业务。
方案二、提供统一的http restful接口或RPC接口，由底层基础服务承接这接口，提供单个和批量加解密服务，各个业务通过调用底层基础服务
       提供的接口即可实现加解密功能。
   优点：各个业务接入简单，不用引入sdk，只需按照接入文档接入，对业务系统没侵入性。
   缺点：业务远程http或rpc调用底层服务提供的加解密接口，有一定的网络io开销，高并发场景调用容易出现超时导致加解密失败。
   适用场景：调用量不大(比如内部系统)、非核心业务（有一定的容错性）。
方案三：client sdk + restful 接口或RPC远程接口结合使用。业务方自己保证高可用，通过加动态配置开关，例如加一个配置encrypt.type=1,2,3
   1: 本地调用加密机   2、restful或RPC远程接口调用加密机   3、默认值。优先restful或RPC远程接口调用，如果调用失败，
   本地加密机兜底二次加密，从而保证加解密功能的高可用。
   优点：融合了方案一和方案二，业务方可以自由选择加密方案，另外针对方案二的缺点，补齐了高可用的能力。
   缺点：业务方使用比较繁琐，需要自己加配置开关进行额外处理。
   适用场景：适用各种场景
不同的业务场景，可以选择不同的方案，互联网项目个人比较推荐方案一和方案三。

存量数据如何快速处理：
1、刷数据的表需要有一个索引字段，最好是类似更新时间之类的字段，另外建议在刷数的表加一个类似refresh_status代表刷新状态字段。
2、提前预估表数量及我们系统处理的能力，分天在低峰期(1-5点)对数据加密处理。例如：表有1亿数据，1小时处理1000w，
   我们可以分两天，低峰期下半夜凌晨1开始跑数据。
3、利用分布式调用框架(xxljob、saturn)的分片功能，并行进行大数据量的处理。可以大大增加系统的处理能力，加快处理速度。

四、架构设计及实现
1、底层framework提供dancechar-framework-encrypt加解密client sdk。
2、dancechar-base-service基础服务模块提供加解密restful接口。
3、业务项目dancechar-core-service初始化加密数据拦截器EncryptPluginConfig.java，数据入库配置了注解字段会加密存储。
4、业务项目dancechar-core-service通过调用加解密工具类client sdk进行数据加解密。
5、业务项目dancechar-core-service通过feign调用基础服务模块的加解密restful接口进行数据加解密。

五、代码演示
整体框架：
spring cloud alibaba + nacos +  mybatis-plus
实现步骤：
1、dancechar-framework-encrypt讲解。
2、dancechar-base-service restful接口讲解。
3、业务项目dancechar-core-service如何接入。


